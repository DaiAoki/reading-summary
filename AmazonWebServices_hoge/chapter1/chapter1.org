#+TITLE: Chapter1
#+OPTIONS: ^:{}
* AWSの基本
** AWSとは
クラウドの概念
物理サーバ vs レンタルサーバ
パブリッククラウド vs プライベートクラウド
*** クラウドとは
クラウドコンピューティングは3つに分類される。
- IaaS(インフラストラクチャサービス)
- PaaS(プラットフォームサービス)
- SaaS(アプリケーションサービス)

**** laaS(インフラストラクチャサービス)
Infrastructure as a Service(Haas - Hardware as a Service)
仮想サーバやストレージ等のリソースをインターネット経由で提供するサービス。
クラウドのレイヤーとしては、一番下の基礎的な部分にあたる。

**** PaaS(プラットフォームサービス)
Plarform as a Service
データベースやアプリケーションサーバ等のミドルウェアをサービスとして提供。

**** SaaS(アプリケーションサービス)
Software as a Service
メール配信、キューサービス、業務管理システム等

**** レイヤー
|------+------------------------------+------------------------------------------|
| SaaS | アプリケーションサービス     | アプリケーション/ソフトウェア            |
|------+------------------------------+------------------------------------------|
| PaaS | プラットフォームサービス     | ミドルウェア(DB, アプリケーションサーバ) |
|------+------------------------------+------------------------------------------|
| IaaS | インフラストラクチャサービス | 仮想コンピュータ/ストレージ/ネットワーク |
|------+------------------------------+------------------------------------------|

*** 物理サーバ（オンプレミス）とAWSの違い
オンプレミスとAWSの違いは大きく2つ
- 所有者
- キャパシティ

*** レンタルサーバ（共有サーバ）とAWSの違い
レンタルサーバ
|---------------------+-----------------------------------------------------------|
| 共用サーバ          | 複数ユーザーが利用する                                    |
| 専用サーバ          | 1台の物理サーバを占有する                                 |
| 仮想専用サーバ(VPS) | 1台の物理サーバ上に仮想のサーバを複数立て、それを専有する |
|---------------------+-----------------------------------------------------------|
共用サーバだと、下記のデメリットがある
- 自由度に低さ
- セキュリティの問題
- 他ユーザの影響の大きさ

専用サーバ、仮想専用サーバは下記のデメリットを克服している

AWSのEC2は、仮想専用サーバに近い。
ただし、EC2はディスクを動的に追加できたりする。
AWSはレンタルサーバが提供するサービスを内包したそれ以上のサービスといえる。

*** プライベートクラウドとAWS
- パブリッククラウド
- プライベートクラウド

*** AWSのサービスの全体像
AWSの中核サービスは、IaaS.
- EC2(コンピュータ処理)
- S3, Glacier, EBS, Storage Gateway(ストレージ)
- VPC, Elastic Load Balancing, Route53, Direct Connect(ネットワーク)
**** Amazon Elastic Compute Cloud(EC2)
仮想サーバ。
仮想サーバの起動元となるマシンイメージはAmazonマシンイメージ(AMI)と呼ばれ、
起動された仮想サーバはインスタンスと呼ばれる。

**** AWS Elastic Load Balancing(ELB)
負荷分散装置。
EC2インスタンスの前に置かれ、複数のEC2インスタンスに通信を振り分ける。

**** Auto Scaling
CPUやメモリ利用率などの決められた条件に応じてEC2インスタンスを自動的に増減させるサービス。
ELBと合わせて利用されることが多い、

**** Amazon Simple Storage Service(S3)
オンラインストレージサービス。
頭にオンラインが付く理由は、S3の操作は全て、HTTP/HTTPSによるAPIへのアクセスを通じて行われるため。

**** Amazon Glacier
データの長期保存向けに設計されたサービス。

**** Amazon Elastic Block Store(EBS)
EC2インスタンスから利用するストレージ。
イメージ的には外付けハードディスク。

**** Amazon Relational Database Service(RDS)
データベースのPaaS。

**** Amazon ElasticCache
インメモリキャッシュシステムのPaaS。
サポートするエンジンとしては、MemcachedとRedisがある。
ElasticCacheを利用することにより、データベースへのキャッシュ機能による高速化や、セッションストアとして耐障害性向上が実現できる。
**** Amazon Virtual Private Cloud(VPC)
AWSのネットワーク内に論理的に分離したネットワークを作成するサービス。

**** AWS Direct Connect
AWSのVPCに接続する専用線接続サービス。

**** Amazon CloudFront
コンテンツ配信ネットワーク(CDN)サービス。
コンテンツをエッジロケーション(全世界に散らばる拠点)から配信する。
ユーザーから一番近いエッジロケーションから配信する。

**** Amazon Route 53
ドメインネームシステム(DNS)サービス。
脆弱性、DDoS攻撃への対応、DNSの運用をほぼマネジメントレスで利用できるサービス。

**** Amazon Simple Queue Service(SQS)
メッセージキューサービス。

**** Amazon Simple Notification Service(SNS)
プッシュ型のメッセージングサービス。

**** Amazon Simple Email Service(SES)
メール配信サービス。

**** AWS Identity and Access Management(IAM)
AWSのアカウント管理サービス

**** AWS CloudTrail
AWS APIの呼び出しを記録してロギングするサービス。




**** Amazon CloudWatch
AWS上のリソースやアプリケーションのモニタリングサービス。

**** AWS Elastic Beantalk
WebアプリケーションサーバのPaaS。
Auto Scalingの設定をしておくことで、アプリケーションの縮退を自動的に行う。

**** AWS CloudFormation
AWSの環境構築を自動化するツール。
AWS上でのインフラ構築を劇的に効率化できる可能性を秘めている。

**** AWSサポート
電話やメール・チャットでの技術面の支援を行う。

**** AWS Trusted Advisor
AWSの適切な利用をサジェストするツール。
[[http://aws.typepad.com/aws_japan/][Amazon Web Servicesブログ]]

** AWSのネットワークサービス
*** リージョンとアベイラビリティゾーン
**** リージョン
AWSがサービスを提供している拠点。
操作するための手段
- ブラウザ(AWSマネジメントコンソール)
- 各種プログラミング言語(SDK)
- 各種OSコマンドラインツール(CLI)

**** アベイラビリティゾーン
データセンターとほぼ同義。
可用性や耐障害性の面からマルチアベイラビリティゾーン構成を基本にシステムを構築することが推奨されている。

*** Amazon Virtual Private Cloud
特になし

*** Amazon Route 53
DNSサービス。

*** AWSネットワークとVPCネットワーク
特になし

** ハードウェアリソースとしてのAWS(IaaS)
*** Amazon Elastic Compute Cloud(EC2)
- 仮想サーバインスタンス
- バックアップイメージ
- ディスク
- ファイアウォール
- 固定グローバルIP

基本的な利用方法は、あらかじめAWSに用意されているAMI(Amazon Machine Image)からディスク容量や、
通信要件を設定したうえで、インスタンスを作成する。

**** インスタンス
従来のオンプレミス環境上のサーバに相当する。
インスタンスが持つ情報
- OS
- CPU
- メモリ

インスタンスタイプはユースケースに応じて、系統が分かれている。
T2インスタンス：汎用的な使用
M3インスタンス：汎用的な使用
C3インスタンス：CPU性能を高くした
C4インスタンス：CPU性能を高くした
R3インスタンス：メモリ容量を大きくした
=> さらに、small/medium/large/xlargeのように性能の選択肢がある

**** EBS
EBS-Backedインスタンス
OSを含むルートデバイスの情報をEBSに格納したインスタンス。

*** Amazon Elastic Block Store
外付けディスクに相当。

*** EC2におけるバックアップ
- AMI(Amazon Machine Image)
- EBSスナップショット

*** Amazon Simple Storage Service(S3)
ストレージサービス。
- FTPサーバのような感覚で単純なファイルの保存領域
- AWSサービスの利用ログの保存
- 静的WebサイトとしてのWebホスティング機能

**** S3のバケットとオブジェクトの概念
バケットというコンテナをリージョンを選択した上で作成し、
そこへオブジェクトとして、データを保存していく。
また、オブジェクトをグルーピングするディレクトリを作成して、
ファイルサーバのようにディレクトリを階層化することも可能。

静的なコンテンツをホスティングすることができる。
動的なコンテンツに関しては、Elastic Beanstalkを利用する、あるいは、EC2で独自にWebサーバを作成する

*** Amazon Glacier
アーカイブストレージサービス。
長期間保存し、アクセス頻度が低く、取り出しに時間がかかっても問題ないデータを保存する

** アプリケーション基盤としてのAWS(PaaS)
*** Amazon Relation Database Service
AWS上でRDBMSを利用する二つの方法
- EC2インスタンスにRDBMSをインストールする方法
- RDS
=>基本的にはRDSを利用するのが良い

**** RDSのインスタンスタイプ
m3インスタンス：標準的
r3インスタンス：メモリ最適化された
マイクロインスタンス：低価格
=> さらにsmall/medium/largeといったスペックがある

一度起動したら常時起動されているため、課金されないようにするにはインスタンスを削除するしかない。

**** マルチAZ
マルチAZ機能はRDSの可用性を高める機能。
有効にすることで、作成したRDSインスタンスに対するスタンバイレプリカが別のAZ(アベイラビリティーゾーン)に作成される。
本番では必ず有効に、開発環境では費用がかさむため、無効に。

*** AWS Elastic Beantalk
アプリケーションをデプロイするだけでサービスを開始できるサービス。
User              ←SNS ←CloudWatch → Auto Scaling
↓(デプロイ)               ↓          ⇅
Elastic Beanstalk →ELB → EC2 Instances ⇄ RDS
                 (構築)

**** ebコマンド
AWS Command Line Interface(CLI)をインストールすることで、ebコマンドが利用可能になる。
ebコマンドを利用すると、Elastic Beantalkにeb deployでアプリケーションをデプロイすることができるようになる。
実行にはPython2.7以上が必要。

*** Amazon ElasticCache
Webシステムの高速化・信頼性の向上のため、データベースへのクエリ結果をキャッシュしたり、
セッション情報をWebサーバ以外に格納したりする。
Elastic Cacheは一つ以上のノードをクラスタ化して提供する。

** サービスとしてのAWS
*** AWSのアプリケーションサービスの概念
複数ユーザーが使用することを前提にサービスを提供しているため、
一時的な負荷の増大も全体でみた時には軽微な負担にしかならない。

*** SESとSQS
メール配信サービスとキューサービス。

*** SNSとCloudWatch
AWSの通知サービス(SNS)、監視サービス(Cloud Watch)

**** Amazon Simple Notification Service(SNS)
プッシュ型の通知サービス。
SQSやCloudWatch等と組み合わせて、システム間の連携や外部への通知等に利用する。

**** Amazon CloudWatch
AWSの各種リソースをモニタリングするサービス。
- 定義した監視条件(メトリクス)に達した時にアラートを通知する機能
- CloudWatch Logsと呼ばれるインスタンスログを格納する機能

** AWSの利用コスト
*** AWSの料金体系
Amazon EC2 料金表
http://aws.amazon.com/jp/ec2/pricing/
クラウドサービス無料利用枠
http://aws.amazon.com/jp/free/

*** AWSの料金計算の仕方


